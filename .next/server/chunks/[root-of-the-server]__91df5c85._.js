module.exports=[76214,e=>{"use strict";var t=e.i(64328);let r=process.env.MONGODB_URI||"mongodb://localhost:27017/kiswastore",a=global.mongoose;async function n(){if(a.conn)return a.conn;a.promise||(a.promise=t.default.connect(r,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}a||(a=global.mongoose={conn:null,promise:null}),e.s(["default",0,n])},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},64328,(e,t,r)=>{t.exports=e.x("mongoose-8b99e611e7552af3",()=>require("mongoose-8b99e611e7552af3"))},84431,e=>{"use strict";var t=e.i(64328);let r=new t.Schema({firstName:{type:String,required:!0},lastName:{type:String,required:!0},email:{type:String,required:!0,unique:!0},phone:{type:String},addresses:[{street:String,city:String,state:String,zip:String,country:String,type:{type:String,enum:["billing","shipping"],default:"shipping"}}],totalSpent:{type:Number,default:0},orderCount:{type:Number,default:0},lastOrderDate:{type:Date}},{timestamps:!0}),a=t.default.models.Customer||t.default.model("Customer",r);e.s(["default",0,a])},69651,e=>{"use strict";var t=e.i(64328);let r=new t.Schema({name:{type:String,required:!0},slug:{type:String,required:!0,unique:!0},sku:{type:String,required:!0,unique:!0},description:{type:String},features:[{type:String}],price:{type:Number,required:!0},currency:{type:String,default:"SAR"},salePrice:{type:Number},costPrice:{type:Number},stock:{type:Number,default:0},inStock:{type:Boolean,default:!0},category:{type:t.Schema.Types.ObjectId,ref:"Category",required:!0},images:[{type:String}],specifications:{type:Map,of:String},isPublished:{type:Boolean,default:!1},isFeatured:{type:Boolean,default:!1}},{timestamps:!0}),a=t.default.models.Product||t.default.model("Product",r);e.s(["default",0,a])},85137,e=>{"use strict";var t=e.i(64328);let r=new t.Schema({orderNumber:{type:String,required:!0,unique:!0},customer:{type:t.Schema.Types.ObjectId,ref:"Customer",required:!0},items:[{product:{type:t.Schema.Types.ObjectId,ref:"Product"},name:String,quantity:Number,price:Number,total:Number}],subtotal:{type:Number,required:!0},tax:{type:Number,default:0},shippingCost:{type:Number,default:0},total:{type:Number,required:!0},status:{type:String,enum:["pending","processing","shipped","delivered","cancelled","refunded"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},shippingAddress:{street:String,city:String,country:String},notes:String},{timestamps:!0}),a=t.default.models.Order||t.default.model("Order",r);e.s(["default",0,a])},53603,e=>{"use strict";var t=e.i(64328);let r=new t.Schema({eventType:{type:String,required:!0,index:!0},url:{type:String,required:!0},timestamp:{type:Date,default:Date.now,index:!0},sessionId:{type:String,required:!0,index:!0},userId:{type:String,index:!0},ip:{type:String},device:{type:{type:String},vendor:{type:String},model:{type:String}},os:{name:{type:String},version:{type:String}},browser:{name:{type:String},version:{type:String},major:{type:String}},engine:{name:{type:String},version:{type:String}},cpu:{architecture:{type:String}},location:{country:{type:String},region:{type:String},city:{type:String},latitude:{type:Number},longitude:{type:Number},timezone:{type:String}},metadata:{type:t.Schema.Types.Mixed}}),a=t.default.models.AnalyticsEvent||t.default.model("AnalyticsEvent",r);e.s(["default",0,a])},92441,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(74677),o=e.i(69741),u=e.i(16795),d=e.i(87718),l=e.i(95169),p=e.i(47587),c=e.i(66012),m=e.i(70101),g=e.i(26937),y=e.i(10372),h=e.i(93695);e.i(52474);var f=e.i(220),S=e.i(89171),x=e.i(76214),v=e.i(85137),w=e.i(84431),b=e.i(69651),R=e.i(53603);async function N(){try{await (0,x.default)();let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),r=new Date(e.getFullYear(),e.getMonth()-1,1),a=new Date(e.getFullYear(),e.getMonth(),0),n=await v.default.find({createdAt:{$gte:t},paymentStatus:"paid"}),i=n.reduce((e,t)=>e+(t.total||0),0),s=await v.default.find({createdAt:{$gte:r,$lte:a},paymentStatus:"paid"}),o=s.reduce((e,t)=>e+(t.total||0),0),u=o>0?((i-o)/o*100).toFixed(1):"0",d=await v.default.countDocuments(),l=n.length,p=s.length,c=p>0?((l-p)/p*100).toFixed(1):"0",m=await w.default.countDocuments(),g=await w.default.countDocuments({createdAt:{$gte:t}}),y=await w.default.countDocuments({createdAt:{$gte:r,$lte:a}}),h=y>0?((g-y)/y*100).toFixed(1):"0",f=new Date(Date.now()-18e5),N=await R.default.distinct("sessionId",{timestamp:{$gte:f}}),E=await v.default.find({}).sort({createdAt:-1}).limit(5).populate("customer","firstName lastName"),C=(await v.default.aggregate([{$unwind:"$items"},{$group:{_id:"$items.name",totalSales:{$sum:"$items.quantity"},revenue:{$sum:"$items.total"}}},{$sort:{totalSales:-1}},{$limit:4}])).map(e=>({name:e._id||"Unknown Product",sales:e.totalSales,revenue:e.revenue})),q=await b.default.countDocuments();return S.NextResponse.json({stats:{revenue:{value:i,change:parseFloat(u),trend:parseFloat(u)>=0?"up":"down"},orders:{value:d,thisMonth:l,change:parseFloat(c),trend:parseFloat(c)>=0?"up":"down"},customers:{value:m,thisMonth:g,change:parseFloat(h),trend:parseFloat(h)>=0?"up":"down"},activeSessions:N.length,products:q},recentOrders:E.map(e=>({_id:e._id,orderNumber:e.orderNumber,customer:e.customer?`${e.customer.firstName} ${e.customer.lastName}`:"Guest",total:e.total,status:e.status,paymentStatus:e.paymentStatus,itemCount:e.items?.length||0,createdAt:e.createdAt})),topProducts:C})}catch(e){return console.error("Dashboard API Error:",e),S.NextResponse.json({error:"Failed to fetch dashboard data"},{status:500})}}e.s(["GET",()=>N],4066);var E=e.i(4066);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/dashboard/route",pathname:"/api/dashboard",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/dashboard/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:q,workUnitAsyncStorage:A,serverHooks:P}=C;function D(){return(0,a.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:A})}async function O(e,t,a){C.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let S="/api/dashboard/route";S=S.replace(/\/index$/,"")||"/";let x=await C.prepare(e,t,{srcPage:S,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:w,nextConfig:b,parsedUrl:R,isDraftMode:N,prerenderManifest:E,routerServerContext:q,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,resolvedPathname:D,clientReferenceManifest:O,serverActionsManifest:T}=x,$=(0,o.normalizeAppPath)(S),k=!!(E.dynamicRoutes[$]||E.routes[D]),_=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,R,!1):t.end("This page could not be found"),null);if(k&&!N){let e=!!E.routes[D],t=E.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await _();throw new h.NoFallbackError}}let j=null;!k||C.isDev||N||(j="/index"===(j=D)?"/":j);let I=!0===C.isDev||!k,F=k&&!I;T&&O&&(0,s.setManifestsSingleton)({page:S,clientReferenceManifest:O,serverActionsManifest:T});let M=e.method||"GET",U=(0,i.getTracer)(),H=U.getActiveScopeSpan(),B={params:w,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>C.onRequestError(e,t,a,n,q)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),L=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let s=async e=>C.handle(L,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${S}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),u=async n=>{var i,u;let d=async({previousCacheEntry:r})=>{try{if(!o&&A&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let u=B.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let d=B.renderOpts.collectedTags;if(!k)return await (0,c.sendResponse)(K,G,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[y.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})},!1,q),t}},l=await C.handleResponse({req:e,nextConfig:b,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!k)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&k||h.delete(y.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,g.getCacheControlHeader)(l.cacheControl)),await (0,c.sendResponse)(K,G,new Response(l.value.body,{headers:h,status:l.value.status||200})),null};H?await u(H):await U.withPropagatedContext(e.headers,()=>U.trace(l.BaseServerSpan.handleRequest,{spanName:`${M} ${S}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},u))}catch(t){if(t instanceof h.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})},!1,q),k)throw t;return await (0,c.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>D,"routeModule",()=>C,"serverHooks",()=>P,"workAsyncStorage",()=>q,"workUnitAsyncStorage",()=>A],92441)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__91df5c85._.js.map