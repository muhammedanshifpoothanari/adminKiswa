{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/muhammedanshifp/Documents/kiswastore/admin/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/kiswastore';\n\nif (!MONGODB_URI) {\n    throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\n}\n\ninterface MongooseCache {\n    conn: typeof mongoose | null;\n    promise: Promise<typeof mongoose> | null;\n}\n\ndeclare global {\n    var mongoose: MongooseCache;\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n    cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n    if (cached.conn) {\n        return cached.conn;\n    }\n\n    if (!cached.promise) {\n        const opts = {\n            bufferCommands: false,\n        };\n\n        cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n            return mongoose;\n        });\n    }\n\n    try {\n        cached.conn = await cached.promise;\n    } catch (e) {\n        cached.promise = null;\n        throw e;\n    }\n\n    return cached.conn;\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAaA,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACT,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC3D;AAEA,eAAe;IACX,IAAI,OAAO,IAAI,EAAE;QACb,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACjB,MAAM,OAAO;YACT,gBAAgB;QACpB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACvD,OAAO;QACX;IACJ;IAEA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,GAAG;QACR,OAAO,OAAO,GAAG;QACjB,MAAM;IACV;IAEA,OAAO,OAAO,IAAI;AACtB;uCAEe"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///Users/muhammedanshifp/Documents/kiswastore/admin/models/AnalyticsEvent.ts"],"sourcesContent":["import mongoose, { Schema, Document, Model } from 'mongoose';\n\nexport interface IAnalyticsEvent extends Document {\n    eventType: string;\n    url: string;\n    timestamp: Date;\n    sessionId: string;\n    userId?: string;\n    ip?: string;\n\n    // Detailed Device Info\n    device: {\n        type?: string; // mobile, tablet, console, smarttv, wearable, embedded\n        vendor?: string;\n        model?: string;\n    };\n    os: {\n        name?: string;\n        version?: string;\n    };\n    browser: {\n        name?: string;\n        version?: string;\n        major?: string;\n    };\n    engine: {\n        name?: string;\n        version?: string;\n    };\n    cpu: {\n        architecture?: string;\n    };\n\n    // Location\n    location: {\n        country?: string;\n        region?: string;\n        city?: string;\n        latitude?: number;\n        longitude?: number;\n        timezone?: string;\n    };\n\n    metadata?: any;\n}\n\nconst AnalyticsEventSchema = new Schema<IAnalyticsEvent>({\n    eventType: { type: String, required: true, index: true },\n    url: { type: String, required: true },\n    timestamp: { type: Date, default: Date.now, index: true },\n    sessionId: { type: String, required: true, index: true },\n    userId: { type: String, index: true },\n    ip: { type: String },\n\n    device: {\n        type: { type: String },\n        vendor: { type: String },\n        model: { type: String }\n    },\n    os: {\n        name: { type: String },\n        version: { type: String }\n    },\n    browser: {\n        name: { type: String },\n        version: { type: String },\n        major: { type: String }\n    },\n    engine: {\n        name: { type: String },\n        version: { type: String }\n    },\n    cpu: {\n        architecture: { type: String }\n    },\n\n    location: {\n        country: { type: String },\n        region: { type: String },\n        city: { type: String },\n        latitude: { type: Number },\n        longitude: { type: Number },\n        timezone: { type: String }\n    },\n\n    metadata: { type: Schema.Types.Mixed }\n});\n\n// Prevent model recompilation error in Next.js hot reload\nconst AnalyticsEvent: Model<IAnalyticsEvent> = mongoose.models.AnalyticsEvent || mongoose.model<IAnalyticsEvent>('AnalyticsEvent', AnalyticsEventSchema);\n\nexport default AnalyticsEvent;\n"],"names":[],"mappings":";;;;AAAA;;AA8CA,MAAM,uBAAuB,IAAI,kKAAM,CAAkB;IACrD,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACvD,KAAK;QAAE,MAAM;QAAQ,UAAU;IAAK;IACpC,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;QAAE,OAAO;IAAK;IACxD,WAAW;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IACvD,QAAQ;QAAE,MAAM;QAAQ,OAAO;IAAK;IACpC,IAAI;QAAE,MAAM;IAAO;IAEnB,QAAQ;QACJ,MAAM;YAAE,MAAM;QAAO;QACrB,QAAQ;YAAE,MAAM;QAAO;QACvB,OAAO;YAAE,MAAM;QAAO;IAC1B;IACA,IAAI;QACA,MAAM;YAAE,MAAM;QAAO;QACrB,SAAS;YAAE,MAAM;QAAO;IAC5B;IACA,SAAS;QACL,MAAM;YAAE,MAAM;QAAO;QACrB,SAAS;YAAE,MAAM;QAAO;QACxB,OAAO;YAAE,MAAM;QAAO;IAC1B;IACA,QAAQ;QACJ,MAAM;YAAE,MAAM;QAAO;QACrB,SAAS;YAAE,MAAM;QAAO;IAC5B;IACA,KAAK;QACD,cAAc;YAAE,MAAM;QAAO;IACjC;IAEA,UAAU;QACN,SAAS;YAAE,MAAM;QAAO;QACxB,QAAQ;YAAE,MAAM;QAAO;QACvB,MAAM;YAAE,MAAM;QAAO;QACrB,UAAU;YAAE,MAAM;QAAO;QACzB,WAAW;YAAE,MAAM;QAAO;QAC1B,UAAU;YAAE,MAAM;QAAO;IAC7B;IAEA,UAAU;QAAE,MAAM,kKAAM,CAAC,KAAK,CAAC,KAAK;IAAC;AACzC;AAEA,0DAA0D;AAC1D,MAAM,iBAAyC,mKAAQ,CAAC,MAAM,CAAC,cAAc,IAAI,mKAAQ,CAAC,KAAK,CAAkB,kBAAkB;uCAEpH"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///Users/muhammedanshifp/Documents/kiswastore/admin/lib/analytics-storage.ts"],"sourcesContent":["import dbConnect from '@/lib/mongodb';\nimport AnalyticsEvent, { IAnalyticsEvent } from '@/models/AnalyticsEvent';\n\n// We just re-export the interface for convenience\nexport type { IAnalyticsEvent as AnalyticsEvent };\n\nexport async function getEvents(): Promise<IAnalyticsEvent[]> {\n    try {\n        await dbConnect();\n        // Return plain objects to avoid serialization issues with Next.js Client Components if passed directly\n        // Sort by timestamp desc\n        const events = await AnalyticsEvent.find({}).sort({ timestamp: -1 }).lean();\n\n        // Convert _id and Date objects to string if needed, but for now returned as is.\n        // If passing to client, need to serialize.\n        return JSON.parse(JSON.stringify(events));\n    } catch (error) {\n        console.error(\"Failed to read events from MongoDB:\", error);\n        return [];\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAKO,eAAe;IAClB,IAAI;QACA,MAAM,IAAA,2HAAS;QACf,uGAAuG;QACvG,yBAAyB;QACzB,MAAM,SAAS,MAAM,qIAAc,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GAAG,IAAI;QAEzE,gFAAgF;QAChF,2CAA2C;QAC3C,OAAO,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;IACrC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,EAAE;IACb;AACJ"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///Users/muhammedanshifp/Documents/kiswastore/admin/app/api/analytics/stats/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getEvents, AnalyticsEvent } from '@/lib/analytics-storage';\n\nexport async function GET() {\n    try {\n        const events = await getEvents();\n\n        const totalPageViews = events.filter(e => e.eventType === 'page_view').length;\n        const uniqueSessions = new Set(events.map(e => e.sessionId)).size;\n\n        // Top Products\n        const productViews = events\n            .filter(e => e.eventType === 'product_view')\n            .reduce((acc, event) => {\n                const name = event.metadata?.name || 'Unknown Product';\n                acc[name] = (acc[name] || 0) + 1;\n                return acc;\n            }, {} as Record<string, number>);\n\n        const topProducts = Object.entries(productViews)\n            .map(([name, count]) => ({ name, count }))\n            .sort((a, b) => b.count - a.count)\n            .slice(0, 5);\n\n        // Device Usage\n        const deviceUsage = events\n            .filter(e => e.eventType === 'page_view')\n            .reduce((acc, event) => {\n                const type = event.device?.type || 'unknown';\n                acc[type] = (acc[type] || 0) + 1;\n                return acc;\n            }, {} as Record<string, number>);\n\n        const deviceStats = Object.entries(deviceUsage).map(([name, value]) => ({ name, value }));\n\n        // Recent Activity\n        const recentActivity = events\n            .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n            .slice(0, 10);\n\n        return NextResponse.json({\n            totalPageViews,\n            uniqueSessions,\n            topProducts,\n            deviceStats,\n            recentActivity\n        });\n    } catch (error) {\n        console.error('Error getting analytics stats:', error);\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,SAAS,MAAM,IAAA,0IAAS;QAE9B,MAAM,iBAAiB,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK,aAAa,MAAM;QAC7E,MAAM,iBAAiB,IAAI,IAAI,OAAO,GAAG,CAAC,CAAA,IAAK,EAAE,SAAS,GAAG,IAAI;QAEjE,eAAe;QACf,MAAM,eAAe,OAChB,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK,gBAC5B,MAAM,CAAC,CAAC,KAAK;YACV,MAAM,OAAO,MAAM,QAAQ,EAAE,QAAQ;YACrC,GAAG,CAAC,KAAK,GAAG,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI;YAC/B,OAAO;QACX,GAAG,CAAC;QAER,MAAM,cAAc,OAAO,OAAO,CAAC,cAC9B,GAAG,CAAC,CAAC,CAAC,MAAM,MAAM,GAAK,CAAC;gBAAE;gBAAM;YAAM,CAAC,GACvC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK,EAChC,KAAK,CAAC,GAAG;QAEd,eAAe;QACf,MAAM,cAAc,OACf,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK,aAC5B,MAAM,CAAC,CAAC,KAAK;YACV,MAAM,OAAO,MAAM,MAAM,EAAE,QAAQ;YACnC,GAAG,CAAC,KAAK,GAAG,CAAC,GAAG,CAAC,KAAK,IAAI,CAAC,IAAI;YAC/B,OAAO;QACX,GAAG,CAAC;QAER,MAAM,cAAc,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC,MAAM,MAAM,GAAK,CAAC;gBAAE;gBAAM;YAAM,CAAC;QAEvF,kBAAkB;QAClB,MAAM,iBAAiB,OAClB,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,IAC9E,KAAK,CAAC,GAAG;QAEd,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB;YACA;YACA;YACA;YACA;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}